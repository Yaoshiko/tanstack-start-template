language: shell

dependsOn:
  - 'drizzle'
  - 'tanstack-start-template'

tasks:
  dev:
    description: Start the development server.
    local: true
    deps:
      - '^:install'
      - 'drizzle:migrate'
      - 'tanstack-start-template:dev'

  db-run:
    description: Run the database container.
    options:
      envFile: '.env'
    local: true
    command: |
      docker run \
        --name $DB_CONTAINER \
        -e POSTGRES_USER=$DB_USER \
        -e POSTGRES_PASSWORD=$DB_PASSWORD \
        -e POSTGRES_DB=$DB_NAME \
        -p 5432:5432 \
        -d \
        postgres:latest || true

  db-rm:
    description: Remove the database container.
    options:
      envFile: '.env'
    local: true
    command: |
      docker rm -f $DB_CONTAINER

  db-stop:
    description: Stop the database container.
    options:
      envFile: '.env'
    local: true
    command: |
      docker stop $DB_CONTAINER

  db-reset:
    description: Reset the database container.
    options:
      envFile: '.env'
    local: true
    command: |
      docker rm -f $DB_CONTAINER

  db-logs:
    description: View the database container logs.
    options:
      envFile: '.env'
    local: true
    command: |
      docker logs $DB_CONTAINER

  db-connect:
    description: Connect to the database container.
    options:
      envFile: '/.env'
    local: true
    command: |
      docker exec -it $DB_CONTAINER psql -U postgres -d tanstack-start-template
