type: tool
language: shell

tasks:
  dev:
    description: Start the development server.
    local: true
    deps:
      - 'node:install'
      - '~:db-run'
      - 'node:dev'

  db-run:
    description: Run the database container.
    options:
      envFile: '/.env'
    deps:
      - '~:db-rm'
    command: |
      docker run \
        --name $DB_CONTAINER \
        -e POSTGRES_USER=$DB_USER \
        -e POSTGRES_PASSWORD=$DB_PASSWORD \
        -e POSTGRES_DB=$DB_NAME \
        -p 5432:5432 \
        -d postgres:latest

  db-rm:
    description: Remove the database container.
    options:
      envFile: '/.env'
    command: |
      docker rm -f $DB_CONTAINER

  db-stop:
    description: Stop the database container.
    options:
      envFile: '/.env'
    command: |
      docker stop $DB_CONTAINER

  db-reset:
    description: Reset the database container.
    options:
      envFile: '/.env'
    command: |
      docker rm -f $DB_CONTAINER

  db-logs:
    description: View the database container logs.
    options:
      envFile: '/.env'
    command: |
      docker logs $DB_CONTAINER

  db-connect:
    description: Connect to the database container.
    options:
      envFile: '/.env'
    command: |
      docker exec -it $DB_CONTAINER psql -U postgres -d tanstack-start-template
