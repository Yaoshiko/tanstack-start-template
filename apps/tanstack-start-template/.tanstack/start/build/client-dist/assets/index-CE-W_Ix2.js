import{n as I,S as Me,D as Q,r as A,j as F,p as te,a as pe}from"./main-PzUuNzoA.js";import{I as ge}from"./input-lfDgITMj.js";import{c as j}from"./utils-DEz_iieQ.js";import{L as le}from"./index-B62k-rH5.js";import{B as be}from"./button-CX__d95m.js";import{c as Fe}from"./createLucideIcon-CNDy2lND.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Se=Fe("loader-circle",ye);function R(a,r){return typeof a=="function"?a(r):a}function T(a,r){return ie(r).reduce((e,t)=>{if(e===null)return null;if(typeof e<"u")return e[t]},a)}function P(a,r,i){const e=ie(r);function t(s){if(!e.length)return R(i,s);const n=e.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[n]:t(s[n])}):{[n]:t()};if(Array.isArray(s)&&typeof n=="number"){const o=s.slice(0,n);return[...o.length?o:new Array(n),t(s[n]),...s.slice(n+1)]}return[...new Array(n),t()]}return t(a)}function Ve(a,r){const i=ie(r);function e(t){if(!t)return;if(i.length===1){const n=i[0];if(Array.isArray(t)&&typeof n=="number")return t.filter((h,d)=>d!==n);const{[n]:o,...c}=t;return c}const s=i.shift();if(typeof s=="string"&&typeof t=="object")return{...t,[s]:e(t[s])};if(typeof s=="number"&&Array.isArray(t)){if(s>=t.length)return t;const n=t.slice(0,s);return[...n.length?n:new Array(s),e(t[s]),...t.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(a)}const we=/^(\d+)$/gm,Ee=/\.(\d+)(?=\.)/gm,Ae=/^(\d+)\./gm,_e=/\.(\d+$)/gm,xe=/\.{2,}/gm,X="__int__",$=`${X}$1`;function ie(a){if(Array.isArray(a))return[...a];if(typeof a!="string")throw new Error("Path must be a string.");return a.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(we,$).replace(Ee,`.${$}.`).replace(Ae,`${$}.`).replace(_e,`.${$}`).replace(xe,".").split(".").map(r=>r.indexOf(X)===0?parseInt(r.substring(X.length),10):r)}function Ie(a){return!(Array.isArray(a)&&a.length===0)}function Y(a,r){const{asyncDebounceMs:i}=r,{onChangeAsync:e,onBlurAsync:t,onSubmitAsync:s,onBlurAsyncDebounceMs:n,onChangeAsyncDebounceMs:o}=r.validators||{},c=i??0,h={cause:"change",validate:e,debounceMs:o??c},d={cause:"blur",validate:t,debounceMs:n??c},u={cause:"submit",validate:s,debounceMs:0},l=m=>({...m,debounceMs:0});switch(a){case"submit":return[l(h),l(d),u];case"blur":return[d];case"change":return[h];case"server":default:return[]}}function Z(a,r){const{onChange:i,onBlur:e,onSubmit:t,onMount:s}=r.validators||{},n={cause:"change",validate:i},o={cause:"blur",validate:e},c={cause:"submit",validate:t},h={cause:"mount",validate:s},d={cause:"server",validate:()=>{}};switch(a){case"mount":return[h];case"submit":return[n,o,c,d];case"server":return[d];case"blur":return[o,d];case"change":default:return[n,d]}}const ee=a=>!!a&&typeof a=="object"&&"fields"in a;function C(a,r){if(Object.is(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;if(a instanceof Map&&r instanceof Map){if(a.size!==r.size)return!1;for(const[t,s]of a)if(!r.has(t)||!Object.is(s,r.get(t)))return!1;return!0}if(a instanceof Set&&r instanceof Set){if(a.size!==r.size)return!1;for(const t of a)if(!r.has(t))return!1;return!0}const i=Object.keys(a),e=Object.keys(r);if(i.length!==e.length)return!1;for(const t of i)if(!e.includes(t)||!C(a[t],r[t]))return!1;return!0}const re=({newFormValidatorError:a,isPreviousErrorFromFormValidator:r,previousErrorValue:i})=>a?{newErrorValue:a,newSource:"form"}:r?{newErrorValue:void 0,newSource:void 0}:i?{newErrorValue:i,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},ae=({formLevelError:a,fieldLevelError:r})=>r?{newErrorValue:r,newSource:"field"}:a?{newErrorValue:a,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function ke(a){const r=new Map;for(const i of a){const e=[...i.path??[]].map(t=>{const s=typeof t=="object"?t.key:t;return typeof s=="number"?`[${s}]`:s}).join(".").replace(/\.\[/g,"[");r.set(e,(r.get(e)??[]).concat(i))}return Object.fromEntries(r)}const ne=a=>{const r=ke(a);return{form:r,fields:r}},B={validate({value:a,validationSource:r},i){const e=i["~standard"].validate(a);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return r==="field"?e.issues:ne(e.issues)},async validateAsync({value:a,validationSource:r},i){const e=await i["~standard"].validate(a);if(e.issues)return r==="field"?e.issues:ne(e.issues)}},ue=a=>!!a&&"~standard"in a,U={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function N(a){function r(u,l,m,f){const v=e(u,l,m,f);({insert:()=>o(v,u,l),remove:()=>c(v),swap:()=>f!==void 0&&d(v,u,l,f),move:()=>f!==void 0&&h(v,u,l,f)})[m]()}function i(u,l){return`${u}[${l}]`}function e(u,l,m,f){const v=[i(u,l)];if(m==="swap")v.push(i(u,f));else if(m==="move"){const[p,M]=[Math.min(l,f),Math.max(l,f)];for(let g=p;g<=M;g++)v.push(i(u,g))}else{const p=a.getFieldValue(u),M=Array.isArray(p)?p.length:0;for(let g=l+1;g<M;g++)v.push(i(u,g))}return Object.keys(a.fieldInfo).filter(p=>v.some(M=>p.startsWith(M)))}function t(u,l){return u.replace(/\[(\d+)\]/,(m,f)=>{const v=parseInt(f,10);return`[${l==="up"?v+1:Math.max(0,v-1)}]`})}function s(u,l){(l==="up"?u:[...u].reverse()).forEach(f=>{const v=t(f.toString(),l),p=a.getFieldMeta(v);p?a.setFieldMeta(f,p):a.setFieldMeta(f,n())})}const n=()=>U,o=(u,l,m)=>{s(u,"down"),u.forEach(f=>{f.toString().startsWith(i(l,m))&&a.setFieldMeta(f,n())})},c=u=>{s(u,"up")},h=(u,l,m,f)=>{const v=new Map(Object.keys(a.fieldInfo).filter(p=>p.startsWith(i(l,m))).map(p=>[p,a.getFieldMeta(p)]));s(u,m<f?"up":"down"),Object.keys(a.fieldInfo).filter(p=>p.startsWith(i(l,f))).forEach(p=>{const M=p.replace(i(l,f),i(l,m)),g=v.get(M);g&&a.setFieldMeta(p,g)})},d=(u,l,m,f)=>{u.forEach(v=>{if(!v.toString().startsWith(i(l,m)))return;const p=v.toString().replace(i(l,m),i(l,f)),[M,g]=[a.getFieldMeta(v),a.getFieldMeta(p)];M&&a.setFieldMeta(p,M),g&&a.setFieldMeta(v,g)})};return{handleArrayFieldMetaShift:r}}function J(a){return{values:a.values??{},errorMap:a.errorMap??{},fieldMetaBase:a.fieldMetaBase??{},isSubmitted:a.isSubmitted??!1,isSubmitting:a.isSubmitting??!1,isValidating:a.isValidating??!1,submissionAttempts:a.submissionAttempts??0,isSubmitSuccessful:a.isSubmitSuccessful??!1,validationMetaMap:a.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class Ce{constructor(r){var i;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var e,t;const s=this.fieldMetaDerived.mount(),n=this.store.mount(),o=()=>{s(),n()};(t=(e=this.options.listeners)==null?void 0:e.onMount)==null||t.call(e,{formApi:this});const{onMount:c}=this.options.validators||{};return c&&this.validateSync("mount"),o},this.update=e=>{var t,s;if(!e)return;const n=this.options;this.options=e;const o=!!((s=(t=e.transform)==null?void 0:t.deps)!=null&&s.some((d,u)=>d!==this.prevTransformArray[u])),c=e.defaultValues&&!C(e.defaultValues,n.defaultValues)&&!this.state.isTouched,h=!C(e.defaultState,n.defaultState)&&!this.state.isTouched;!c&&!h&&!o||I(()=>{this.baseStore.setState(()=>J(Object.assign({},this.state,h?e.defaultState:{},c?{values:e.defaultValues}:{},o?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,t)=>{const{fieldMeta:s}=this.state,n=this.resetFieldMeta(s);e&&!t?.keepDefaultValues&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var o;return J({...this.options.defaultState,values:e??this.options.defaultValues??((o=this.options.defaultState)==null?void 0:o.values),fieldMetaBase:n})})},this.validateAllFields=async e=>{const t=[];return I(()=>{Object.values(this.fieldInfo).forEach(n=>{if(!n.instance)return;const o=n.instance;t.push(Promise.resolve().then(()=>o.validate(e,{skipFormValidation:!0}))),n.instance.state.meta.isTouched||n.instance.setMeta(c=>({...c,isTouched:!0}))})}),(await Promise.all(t)).flat()},this.validateArrayFieldsStartingFrom=async(e,t,s)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null,c=[`${e}[${t}]`];for(let l=t+1;l<=(o??0);l++)c.push(`${e}[${l}]`);const h=Object.keys(this.fieldInfo).filter(l=>c.some(m=>l.startsWith(m))),d=[];return I(()=>{h.forEach(l=>{d.push(Promise.resolve().then(()=>this.validateField(l,s)))})}),(await Promise.all(d)).flat()},this.validateField=(e,t)=>{var s;const n=(s=this.fieldInfo[e])==null?void 0:s.instance;return n?(n.state.meta.isTouched||n.setMeta(o=>({...o,isTouched:!0})),n.validate(t)):[]},this.validateSync=e=>{const t=Z(e,this.options);let s=!1;const n={};return I(()=>{var o,c;for(const d of t){if(!d.validate)continue;const u=this.runValidator({validate:d.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:l,fieldErrors:m}=K(u),f=W(d.cause);for(const v of Object.keys(this.state.fieldMeta)){const p=this.getFieldMeta(v);if(!p)continue;const{errorMap:M,errorSourceMap:g}=p,y=m?.[v],{newErrorValue:V,newSource:w}=re({newFormValidatorError:y,isPreviousErrorFromFormValidator:g?.[f]==="form",previousErrorValue:M?.[f]});w==="form"&&(n[v]={...n[v],[f]:y}),M?.[f]!==V&&this.setFieldMeta(v,E=>({...E,errorMap:{...E.errorMap,[f]:V},errorSourceMap:{...E.errorSourceMap,[f]:w}}))}((o=this.state.errorMap)==null?void 0:o[f])!==l&&this.baseStore.setState(v=>({...v,errorMap:{...v.errorMap,[f]:l}})),(l||m)&&(s=!0)}const h=W("submit");(c=this.state.errorMap)!=null&&c[h]&&e!=="submit"&&!s&&this.baseStore.setState(d=>({...d,errorMap:{...d.errorMap,[h]:void 0}}))}),{hasErrored:s,fieldsErrorMap:n}},this.validateAsync=async e=>{const t=Y(e,this.options);this.state.isFormValidating||this.baseStore.setState(h=>({...h,isFormValidating:!0}));const s=[];let n;for(const h of t){if(!h.validate)continue;const d=W(h.cause),u=this.state.validationMetaMap[d];u?.lastAbortController.abort();const l=new AbortController;this.state.validationMetaMap[d]={lastAbortController:l},s.push(new Promise(async m=>{let f;try{f=await new Promise((g,y)=>{setTimeout(async()=>{if(l.signal.aborted)return g(void 0);try{g(await this.runValidator({validate:h.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:l.signal},type:"validateAsync"}))}catch(V){y(V)}},h.debounceMs)})}catch(g){f=g}const{formError:v,fieldErrors:p}=K(f);p&&(n=n?{...n,...p}:p);const M=W(h.cause);for(const g of Object.keys(this.state.fieldMeta)){const y=this.getFieldMeta(g);if(!y)continue;const{errorMap:V,errorSourceMap:w}=y,E=n?.[g],{newErrorValue:_,newSource:k}=re({newFormValidatorError:E,isPreviousErrorFromFormValidator:w?.[M]==="form",previousErrorValue:V?.[M]});V?.[M]!==_&&this.setFieldMeta(g,S=>({...S,errorMap:{...S.errorMap,[M]:_},errorSourceMap:{...S.errorSourceMap,[M]:k}}))}this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[M]:v}})),m(n?{fieldErrors:n,errorMapKey:M}:void 0)}))}let o=[];const c={};if(s.length){o=await Promise.all(s);for(const h of o)if(h?.fieldErrors){const{errorMapKey:d}=h;for(const[u,l]of Object.entries(h.fieldErrors)){const f={...c[u]||{},[d]:l};c[u]=f}}}return this.baseStore.setState(h=>({...h,isFormValidating:!1})),c},this.validate=e=>{const{hasErrored:t,fieldsErrorMap:s}=this.validateSync(e);return t&&!this.options.asyncAlways?s:this.validateAsync(e)},this.getFieldValue=e=>T(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var t;return(t=this.fieldInfo)[e]||(t[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,t)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[e]:R(t,s.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((t,s)=>{const n=s;return t[n]=U,t},{}),this.setFieldValue=(e,t,s)=>{const n=s?.dontUpdateMeta??!1;I(()=>{n||this.setFieldMeta(e,o=>({...o,isTouched:!0,isDirty:!0,errorMap:{...o?.errorMap,onMount:void 0}})),this.baseStore.setState(o=>({...o,values:P(o.values,e,t)}))})},this.deleteField=e=>{const s=[...Object.keys(this.fieldInfo).filter(n=>{const o=e.toString();return n!==o&&n.startsWith(o)}),e];this.baseStore.setState(n=>{const o={...n};return s.forEach(c=>{o.values=Ve(o.values,c),delete this.fieldInfo[c],delete o.fieldMetaBase[c]}),o})},this.pushFieldValue=(e,t,s)=>{this.setFieldValue(e,n=>[...Array.isArray(n)?n:[],t],s),this.validateField(e,"change")},this.insertFieldValue=async(e,t,s,n)=>{this.setFieldValue(e,o=>[...o.slice(0,t),s,...o.slice(t)],n),await this.validateField(e,"change"),N(this).handleArrayFieldMetaShift(e,t,"insert"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.replaceFieldValue=async(e,t,s,n)=>{this.setFieldValue(e,o=>o.map((c,h)=>h===t?s:c),n),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.removeFieldValue=async(e,t,s)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(e,c=>c.filter((h,d)=>d!==t),s),N(this).handleArrayFieldMetaShift(e,t,"remove"),o!==null){const c=`${e}[${o}]`;this.deleteField(c)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.swapFieldValues=(e,t,s,n)=>{this.setFieldValue(e,o=>{const c=o[t],h=o[s];return P(P(o,`${t}`,h),`${s}`,c)},n),N(this).handleArrayFieldMetaShift(e,t,"swap",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.moveFieldValues=(e,t,s,n)=>{this.setFieldValue(e,o=>{const c=[...o];return c.splice(s,0,c.splice(t,1)[0]),c},n),N(this).handleArrayFieldMetaShift(e,t,"move",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.clearFieldValues=(e,t)=>{const s=this.getFieldValue(e),n=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(e,[],t),n!==null)for(let o=0;o<=n;o++){const c=`${e}[${o}]`;this.deleteField(c)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:U},values:this.options.defaultValues?P(t.values,e,T(this.options.defaultValues,e)):t.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[t,s])=>(Object.keys(s).length&&s.errors.length&&(e[t]={errors:s.errors,errorMap:s.errorMap}),e),{})}),this.parseValuesWithSchema=e=>B.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>B.validateAsync({value:this.state.values,validationSource:"form"},e),this.baseStore=new Me(J({...r?.defaultState,values:r?.defaultValues??((i=r?.defaultState)==null?void 0:i.values)})),this.fieldMetaDerived=new Q({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var n,o,c;const h=s,d=e?.[0],u=t[0];let l=0;const m={};for(const f of Object.keys(u.fieldMetaBase)){const v=u.fieldMetaBase[f],p=d?.fieldMetaBase[f],M=h?.[f],g=T(u.values,f);let y=M?.errors;if(!p||v.errorMap!==p.errorMap){y=Object.values(v.errorMap??{}).filter(k=>k!==void 0);const _=(n=this.getFieldInfo(f))==null?void 0:n.instance;_&&!_.options.disableErrorFlat&&(y=y?.flat(1))}const V=!Ie(y??[]),w=!v.isDirty,E=C(g,T(this.options.defaultValues,f))||C(g,(c=(o=this.getFieldInfo(f))==null?void 0:o.instance)==null?void 0:c.options.defaultValue);if(M&&M.isPristine===w&&M.isValid===V&&M.isDefaultValue===E&&M.errors===y&&v===p){m[f]=M,l++;continue}m[f]={...v,errors:y,isPristine:w,isValid:V,isDefaultValue:E}}return Object.keys(u.fieldMetaBase).length&&h&&l===Object.keys(u.fieldMetaBase).length?h:m}}),this.store=new Q({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var n,o,c,h;const d=s,u=e?.[0],l=t[0],m=t[1],f=Object.values(m).filter(Boolean),v=f.some(b=>b.isValidating),p=f.every(b=>b.isValid),M=f.some(b=>b.isTouched),g=f.some(b=>b.isBlurred),y=f.every(b=>b.isDefaultValue),V=M&&((n=l.errorMap)==null?void 0:n.onMount),w=f.some(b=>b.isDirty),E=!w,_=!!((o=l.errorMap)!=null&&o.onMount||f.some(b=>{var x;return(x=b?.errorMap)==null?void 0:x.onMount})),k=!!v;let S=d?.errors??[];(!u||l.errorMap!==u.errorMap)&&(S=Object.values(l.errorMap).reduce((b,x)=>x===void 0?b:x&&ee(x)?(b.push(x.form),b):(b.push(x),b),[]));const O=S.length===0,D=p&&O,ve=this.options.canSubmitWhenInvalid??!1,se=l.submissionAttempts===0&&!M&&!_||!k&&!l.isSubmitting&&D||ve;let L=l.errorMap;if(V&&(S=S.filter(b=>b!==l.errorMap.onMount),L=Object.assign(L,{onMount:void 0})),d&&u&&d.errorMap===L&&d.fieldMeta===this.fieldMetaDerived.state&&d.errors===S&&d.isFieldsValidating===v&&d.isFieldsValid===p&&d.isFormValid===O&&d.isValid===D&&d.canSubmit===se&&d.isTouched===M&&d.isBlurred===g&&d.isPristine===E&&d.isDefaultValue===y&&d.isDirty===w&&C(u,l))return d;let G={...l,errorMap:L,fieldMeta:this.fieldMetaDerived.state,errors:S,isFieldsValidating:v,isFieldsValid:p,isFormValid:O,isValid:D,canSubmit:se,isTouched:M,isBlurred:g,isPristine:E,isDefaultValue:y,isDirty:w};const q=((c=this.options.transform)==null?void 0:c.deps)??[];if(q.length!==this.prevTransformArray.length||q.some((b,x)=>b!==this.prevTransformArray[x])){const b=Object.assign({},this,{state:G});(h=this.options.transform)==null||h.fn(b),G=b.state,this.prevTransformArray=q}return G}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(r||{})}get state(){return this.store.state}runValidator(r){return ue(r.validate)?B[r.type](r.value,r.validate):r.validate(r.value)}async handleSubmit(r){var i,e,t,s,n,o,c,h;if(this.baseStore.setState(u=>({...u,isSubmitted:!1,submissionAttempts:u.submissionAttempts+1,isSubmitSuccessful:!1})),I(()=>{Object.values(this.fieldInfo).forEach(u=>{u.instance&&(u.instance.state.meta.isTouched||u.instance.setMeta(l=>({...l,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(u=>({...u,isSubmitting:!0}));const d=()=>{this.baseStore.setState(u=>({...u,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){d(),(e=(i=this.options).onSubmitInvalid)==null||e.call(i,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){d(),(s=(t=this.options).onSubmitInvalid)==null||s.call(t,{value:this.state.values,formApi:this});return}I(()=>{Object.values(this.fieldInfo).forEach(u=>{var l,m,f;(f=(m=(l=u.instance)==null?void 0:l.options.listeners)==null?void 0:m.onSubmit)==null||f.call(m,{value:u.instance.state.value,fieldApi:u.instance})})}),(o=(n=this.options.listeners)==null?void 0:n.onSubmit)==null||o.call(n,{formApi:this});try{await((h=(c=this.options).onSubmit)==null?void 0:h.call(c,{value:this.state.values,formApi:this,meta:r??this.options.onSubmitMeta})),I(()=>{this.baseStore.setState(u=>({...u,isSubmitted:!0,isSubmitSuccessful:!0})),d()})}catch(u){throw this.baseStore.setState(l=>({...l,isSubmitSuccessful:!1})),d(),u}}setErrorMap(r){I(()=>{Object.entries(r).forEach(([i,e])=>{const t=i;if(ee(e)){const{formError:s,fieldErrors:n}=K(e);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,h=>({...h,errorMap:{...h.errorMap,[t]:n?.[o]},errorSourceMap:{...h.errorSourceMap,[t]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[t]:s}}))}else this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,[t]:e}}))})})}}function K(a){if(a){if(ee(a)){const r=K(a.form).formError,i=a.fields;return{formError:r,fieldErrors:i}}return{formError:a}}return{formError:void 0}}function W(a){switch(a){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class Be{constructor(r){this.options={},this.mount=()=>{var i,e;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const s=this.getInfo();s.instance=this,this.update(this.options);const{onMount:n}=this.options.validators||{};if(n){const o=this.runValidator({validate:n,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(c=>({...c,errorMap:{...c?.errorMap,onMount:o},errorSourceMap:{...c?.errorSourceMap,onMount:"field"}}))}return(e=(i=this.options.listeners)==null?void 0:i.onMount)==null||e.call(i,{value:this.state.value,fieldApi:this}),t},this.update=i=>{this.options=i;const e=this.name!==i.name;if(this.name=i.name,this.state.value===void 0){const t=T(i.form.options.defaultValues,i.name),s=i.defaultValue??t;e?this.setValue(n=>n||s,{dontUpdateMeta:!0}):s!==void 0&&this.setValue(s,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(i,e)=>{this.form.setFieldValue(this.name,i,e),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=i=>this.form.setFieldMeta(this.name,i),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(i,e)=>{this.form.pushFieldValue(this.name,i,e),this.triggerOnChangeListener()},this.insertValue=(i,e,t)=>{this.form.insertFieldValue(this.name,i,e,t),this.triggerOnChangeListener()},this.replaceValue=(i,e,t)=>{this.form.replaceFieldValue(this.name,i,e,t),this.triggerOnChangeListener()},this.removeValue=(i,e)=>{this.form.removeFieldValue(this.name,i,e),this.triggerOnChangeListener()},this.swapValues=(i,e,t)=>{this.form.swapFieldValues(this.name,i,e,t),this.triggerOnChangeListener()},this.moveValue=(i,e,t)=>{this.form.moveFieldValues(this.name,i,e,t),this.triggerOnChangeListener()},this.clearValues=i=>{this.form.clearFieldValues(this.name,i),this.triggerOnChangeListener()},this.getLinkedFields=i=>{const e=Object.values(this.form.fieldInfo),t=[];for(const s of e){if(!s.instance)continue;const{onChangeListenTo:n,onBlurListenTo:o}=s.instance.options.validators||{};i==="change"&&n?.includes(this.name)&&t.push(s.instance),i==="blur"&&o?.includes(this.name)&&t.push(s.instance)}return t},this.validateSync=(i,e)=>{var t;const s=Z(i,this.options),o=this.getLinkedFields(i).reduce((d,u)=>{const l=Z(i,u.options);return l.forEach(m=>{m.field=u}),d.concat(l)},[]);let c=!1;I(()=>{const d=(u,l)=>{var m;const f=z(l.cause),v=l.validate?oe(u.runValidator({validate:l.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):void 0,p=e[f],{newErrorValue:M,newSource:g}=ae({formLevelError:p,fieldLevelError:v});((m=u.state.meta.errorMap)==null?void 0:m[f])!==M&&u.setMeta(y=>({...y,errorMap:{...y.errorMap,[f]:M},errorSourceMap:{...y.errorSourceMap,[f]:g}})),M&&(c=!0)};for(const u of s)d(this,u);for(const u of o)u.validate&&d(u.field,u)});const h=z("submit");return(t=this.state.meta.errorMap)!=null&&t[h]&&i!=="submit"&&!c&&this.setMeta(d=>({...d,errorMap:{...d.errorMap,[h]:void 0},errorSourceMap:{...d.errorSourceMap,[h]:void 0}})),{hasErrored:c}},this.validateAsync=async(i,e)=>{const t=Y(i,this.options),s=await e,n=this.getLinkedFields(i),o=n.reduce((l,m)=>{const f=Y(i,m.options);return f.forEach(v=>{v.field=m}),l.concat(f)},[]);this.state.meta.isValidating||this.setMeta(l=>({...l,isValidating:!0}));for(const l of n)l.setMeta(m=>({...m,isValidating:!0}));const c=[],h=[],d=(l,m,f)=>{const v=z(m.cause),p=l.getInfo().validationMetaMap[v];p?.lastAbortController.abort();const M=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:M},f.push(new Promise(async g=>{var y;let V;try{V=await new Promise((S,O)=>{this.timeoutIds.validations[m.cause]&&clearTimeout(this.timeoutIds.validations[m.cause]),this.timeoutIds.validations[m.cause]=setTimeout(async()=>{if(M.signal.aborted)return S(void 0);try{S(await this.runValidator({validate:m.validate,value:{value:l.store.state.value,fieldApi:l,signal:M.signal,validationSource:"field"},type:"validateAsync"}))}catch(D){O(D)}},m.debounceMs)})}catch(S){V=S}if(M.signal.aborted)return g(void 0);const w=oe(V),E=(y=s[this.name])==null?void 0:y[v],{newErrorValue:_,newSource:k}=ae({formLevelError:E,fieldLevelError:w});l.setMeta(S=>({...S,errorMap:{...S?.errorMap,[v]:_},errorSourceMap:{...S.errorSourceMap,[v]:k}})),g(_)}))};for(const l of t)l.validate&&d(this,l,c);for(const l of o)l.validate&&d(l.field,l,h);let u=[];(c.length||h.length)&&(u=await Promise.all(c),await Promise.all(h)),this.setMeta(l=>({...l,isValidating:!1}));for(const l of n)l.setMeta(m=>({...m,isValidating:!1}));return u.filter(Boolean)},this.validate=(i,e)=>{var t;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=e?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(i),{hasErrored:n}=this.validateSync(i,s[this.name]??{});if(n&&!this.options.asyncAlways)return(t=this.getInfo().validationMetaMap[z(i)])==null||t.lastAbortController.abort(),this.state.meta.errors;const o=e?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(i);return this.validateAsync(i,o)},this.handleChange=i=>{this.setValue(i)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(e=>({...e,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=i=>B.validate({value:this.state.value,validationSource:"field"},i),this.parseValueWithSchemaAsync=i=>B.validateAsync({value:this.state.value,validationSource:"field"},i),this.form=r.form,this.name=r.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new Q({deps:[this.form.store],fn:()=>{const i=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...U,...r.defaultMeta};return{value:i,meta:e}}}),this.options=r}get state(){return this.store.state}runValidator(r){return ue(r.validate)?B[r.type](r.value,r.validate):r.validate(r.value)}setErrorMap(r){this.setMeta(i=>({...i,errorMap:{...i.errorMap,...r}}))}triggerOnBlurListener(){var r,i,e,t,s,n;const o=(r=this.form.options.listeners)==null?void 0:r.onBlurDebounceMs;o&&o>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var h,d;(d=(h=this.form.options.listeners)==null?void 0:h.onBlur)==null||d.call(h,{formApi:this.form,fieldApi:this})},o)):(e=(i=this.form.options.listeners)==null?void 0:i.onBlur)==null||e.call(i,{formApi:this.form,fieldApi:this});const c=(t=this.options.listeners)==null?void 0:t.onBlurDebounceMs;c&&c>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var h,d;(d=(h=this.options.listeners)==null?void 0:h.onBlur)==null||d.call(h,{value:this.state.value,fieldApi:this})},c)):(n=(s=this.options.listeners)==null?void 0:s.onBlur)==null||n.call(s,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var r,i,e,t,s,n;const o=(r=this.form.options.listeners)==null?void 0:r.onChangeDebounceMs;o&&o>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var h,d;(d=(h=this.form.options.listeners)==null?void 0:h.onChange)==null||d.call(h,{formApi:this.form,fieldApi:this})},o)):(e=(i=this.form.options.listeners)==null?void 0:i.onChange)==null||e.call(i,{formApi:this.form,fieldApi:this});const c=(t=this.options.listeners)==null?void 0:t.onChangeDebounceMs;c&&c>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var h,d;(d=(h=this.options.listeners)==null?void 0:h.onChange)==null||d.call(h,{value:this.state.value,fieldApi:this})},c)):(n=(s=this.options.listeners)==null?void 0:s.onChange)==null||n.call(s,{value:this.state.value,fieldApi:this})}}function oe(a){if(a)return a}function z(a){switch(a){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}const H=typeof window<"u"?A.useLayoutEffect:A.useEffect;function Oe(a){const[r]=A.useState(()=>{const e=new Be({...a,form:a.form,name:a.name});return e.Field=de,e});return H(r.mount,[r]),H(()=>{r.update(a)}),te(r.store,a.mode==="array"?i=>[i.meta,Object.keys(i.value??[]).length]:void 0),r}const de=({children:a,...r})=>{const i=Oe(r),e=A.useMemo(()=>R(a,i),[a,i,i.state.value,i.state.meta]);return F.jsx(F.Fragment,{children:e})};function De({form:a,selector:r,children:i}){const e=te(a.store,r);return R(i,e)}function Te(a){const[r]=A.useState(()=>{const i=new Ce(a),e=i;return e.Field=function(s){return F.jsx(de,{...s,form:i})},e.Subscribe=t=>F.jsx(De,{form:i,selector:t.selector,children:t.children}),e});return H(r.mount,[]),te(r.store,i=>i.isSubmitting),H(()=>{r.update(a)}),r}function je(){const a=A.createContext(null);function r(){const t=A.useContext(a);if(!t)throw new Error("`fieldContext` only works when within a `fieldComponent` passed to `createFormHook`");return t}const i=A.createContext(null);function e(){const t=A.useContext(i);if(!t)throw new Error("`formContext` only works when within a `formComponent` passed to `createFormHook`");return t}return{fieldContext:a,useFieldContext:r,useFormContext:e,formContext:i}}function Le({fieldComponents:a,fieldContext:r,formContext:i,formComponents:e}){function t(n){const o=Te(n),c=A.useMemo(()=>({children:u})=>F.jsx(i.Provider,{value:o,children:u}),[o]),h=A.useMemo(()=>({children:u,...l})=>F.jsx(o.Field,{...l,children:m=>F.jsx(r.Provider,{value:m,children:u(Object.assign(m,a))})}),[o]);return A.useMemo(()=>Object.assign(o,{AppField:h,AppForm:c,...e}),[o,h,c])}function s({render:n,props:o}){return c=>n({...o,...c})}return{useAppForm:t,withForm:s}}const{fieldContext:Pe,useFieldContext:ce,formContext:$e,useFormContext:Ne}=je();function he({isDirty:a,isBlurred:r,error:i,className:e}){return a&&r&&!!i&&F.jsx(le,{className:j("text-destructive italic",e),children:i})}function fe({label:a,className:r,children:i}){return F.jsxs("div",{className:j("grid gap-2",r),children:[F.jsx(le,{htmlFor:"email",children:a}),i]})}function We(a){const r=ce();return F.jsxs(fe,{label:a.label,children:[F.jsx(ge,{id:r.name,value:r.state.value,onChange:i=>r.handleChange(i.target.value),onBlur:r.handleBlur,...a}),F.jsx(he,{isDirty:r.state.meta.isDirty,isBlurred:r.state.meta.isBlurred,error:r.state.meta.errors.map(i=>i?.message).find(i=>!!i)})]})}const me=A.forwardRef(function({loading:r,children:i,...e},t){const{pending:s}=pe.useFormStatus(),n=r??s;return F.jsx(be,{ref:t,disabled:n,...e,children:F.jsxs(F.Fragment,{children:[n&&F.jsx(Se,{className:"ml-2 h-4 w-4 animate-spin"}),i]})})});me.displayName="LoadingButton";function ze({label:a,className:r}){const i=Ne();return F.jsx(i.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([e,t])=>F.jsx(me,{type:"submit",className:j("w-full",r),loading:t,disabled:!e,children:a})})}function Ke({label:a,description:r,className:i,children:e,onSubmit:t,...s}){const n=o=>{o.preventDefault(),o.stopPropagation(),t?.(o)};return F.jsxs("form",{className:j("flex flex-col gap-6",i),onSubmit:n,...s,children:[F.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[F.jsx("h1",{className:"text-2xl font-bold",children:a}),r&&F.jsx("p",{className:"text-muted-foreground text-sm text-balance",children:r})]}),e]})}function Ue({className:a,...r}){return F.jsx("textarea",{"data-slot":"textarea",className:j("flex field-sizing-content min-h-16 w-full rounded-md border border-slate-200 bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none placeholder:text-slate-500 focus-visible:border-slate-950 focus-visible:ring-[3px] focus-visible:ring-slate-950/50 disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:border-red-500 aria-invalid:ring-red-500/20 md:text-sm dark:border-slate-800 dark:placeholder:text-slate-400 dark:focus-visible:border-slate-300 dark:focus-visible:ring-slate-300/50 dark:aria-invalid:border-red-900 dark:aria-invalid:ring-red-500/40 dark:aria-invalid:ring-red-900/20 dark:dark:aria-invalid:ring-red-900/40",a),...r})}function He(a){const r=ce();return F.jsxs(fe,{label:a.label,children:[F.jsx(Ue,{id:r.name,value:r.state.value,onChange:i=>r.handleChange(i.target.value),onBlur:r.handleBlur,...a}),F.jsx(he,{isDirty:r.state.meta.isDirty,isBlurred:r.state.meta.isBlurred,error:r.state.meta.errors.map(i=>i?.message).find(i=>!!i)})]})}const{useAppForm:Ze}=Le({fieldComponents:{TextField:We,TextAreaField:He},formComponents:{FormWrapper:Ke,SubmitButton:ze},fieldContext:Pe,formContext:$e});export{Ze as u};
