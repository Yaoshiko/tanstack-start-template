type: library
language: typescript
tags:
  - docker

fileGroups:
  inputs:
    - './src/**/*'
    - './drizzle.config.ts'
  migrations:
    - './migrations/**/*'

tasks:
  generate:
    description: Generate the database schema.
    command: drizzle-kit generate
    inputs:
      - '@globs(inputs)'
    outputs:
      - '@globs(migrations)'

  migrate:
    description: Run the database migrations.
    command: drizzle-kit migrate
    local: true
    options:
      envFile:
        - '/.env'
    inputs:
      - '@globs(migrations)'

  studio:
    description: Open the database studio.
    local: true
    options:
      envFile:
        - '/.env'
    command: drizzle-kit studio

  seed:
    description: Seed the database.
    command: npx tsx seed.ts
    options:
      envFile:
        - '/.env'
    inputs:
      - './seed.ts'

  docker-build:
    deps:
      - '~:generate'
    inputs:
      - '@globs(migrations)'
    env:
      DOCKER_NAME: tanstack-start-template

  docker-push:
    env:
      DOCKER_NAME: tanstack-start-template
